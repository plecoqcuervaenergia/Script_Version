[
    {
        "id": "2712839e4de2d960",
        "type": "tab",
        "label": "Fotovoltaica_UNIV_MADRID",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "7270bff791d922f6",
        "type": "group",
        "z": "2712839e4de2d960",
        "style": {
            "stroke": "#2a2a2a",
            "stroke-opacity": "1",
            "fill": "#0d0d0d",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "e67f099aa8cac4cf",
            "2895484c0427f6fa",
            "f6f619f0448031fb",
            "6bfa28b54d55b8ef",
            "5cd7e5a7fa3ae97d",
            "bb30ecb042f62688",
            "518bc6419c455688",
            "9ca92545bcb3112e",
            "1b5fc013da142ca2",
            "82cda4b23e81bef8",
            "a36fa9eca0f14f8c",
            "fa29f937cfa1a388",
            "6e936e0799b6103e",
            "6d8910b10fc02638",
            "d5a21d2008515361",
            "944af3f5821a881c",
            "afabf483ebd8d3ad",
            "968bce566a51f483",
            "5100f29857b7e882"
        ],
        "x": 874,
        "y": 759,
        "w": 1792,
        "h": 502
    },
    {
        "id": "76c0e9f2c89dabb0",
        "type": "group",
        "z": "2712839e4de2d960",
        "style": {
            "stroke": "#2a2a2a",
            "stroke-opacity": "1",
            "fill": "#0d0d0d",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "f1e5d6761ba3dc38",
            "db5fb5456e5f6a1b",
            "321677345e439252",
            "26825d69f722cab8",
            "6d5655c24320f762",
            "41ef5e6f770811db",
            "9c94e6c47e045cc6",
            "79ac5da96863155c",
            "86d6f79577104659",
            "4f7f84fb02f728f6",
            "ce267b434ea48920",
            "cbcffaba4f2a5fe1",
            "8080b13d4e3a0db0"
        ],
        "x": 874,
        "y": 239,
        "w": 1272,
        "h": 342
    },
    {
        "id": "ba3398c131b492c3",
        "type": "group",
        "z": "2712839e4de2d960",
        "style": {
            "stroke": "#2a2a2a",
            "stroke-opacity": "1",
            "fill": "#0d0d0d",
            "fill-opacity": "0.5",
            "label": true,
            "label-position": "nw",
            "color": "#cccccc"
        },
        "nodes": [
            "80aec98ec71fd81a",
            "2eb7b242fa01841f",
            "53ea2fd20daf41b8",
            "6d977a5c73cafa31"
        ],
        "x": 874,
        "y": 19,
        "w": 472,
        "h": 162
    },
    {
        "id": "f1e5d6761ba3dc38",
        "type": "mysql",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "mydb": "8abc56218783dc0e",
        "name": "DB_Fotov_UNIV_Madrid",
        "x": 1550,
        "y": 480,
        "wires": [
            [
                "86d6f79577104659",
                "8080b13d4e3a0db0"
            ]
        ]
    },
    {
        "id": "db5fb5456e5f6a1b",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "Control_Formato_Graf",
        "func": "msg.ui_control = {\n    options: {\n        scales: {\n            xAxes: [\n                {\n                    stacked: true,\n                    ticks: {\n                        fontColor: '#FFFFFF'\n                    },\n                    gridLines: {\n                        // ConfiguraciÃ³n para OCULTAR lÃ­neas verticales del eje X\n                        zeroLineColor: '#FFFFFF',\n                        color: '#FFFFFF',\n                        lineWidth: 0.0,\n                        display: false           // Mantenemos esto si solo quieres lÃ­neas horizontales\n                    },\n                }\n            ],\n            yAxes: [{\n                stacked: true,\n                ticks: {\n                    fontColor: '#FFFFFF'\n                },\n                gridLines: {\n                    // >>>>>>>>>> CONFIGURACIÃ“N PARA MOSTRAR LÃNEAS HORIZONTALES DEL EJE Y <<<<<<<<<<<\n                    zeroLineColor: '#FFFFFF', // Color de la lÃ­nea en el valor 0\n                    color: '#FFFFFF',         // Color de las otras lÃ­neas de la cuadrÃ­cula\n                    lineWidth: 0.5,           // Grosor de las lÃ­neas (mayor que 0 para que se vean)\n                    // display: false        // Â¡COMENTA O ELIMINA esta lÃ­nea para que sean visibles!\n                    // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n                },\n                // Puedes aÃ±adir aquÃ­ min/max si quieres definir el rango\n                // min: 0,\n                // max: 100\n            }]\n        }\n    }\n}\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 360,
        "wires": [
            [
                "41ef5e6f770811db"
            ]
        ]
    },
    {
        "id": "321677345e439252",
        "type": "inject",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "EjecuciÃ³n_CÃ³digo",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1010,
        "y": 360,
        "wires": [
            [
                "4f7f84fb02f728f6"
            ]
        ]
    },
    {
        "id": "26825d69f722cab8",
        "type": "ui_template",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "group": "0a6525c364ecabac",
        "name": "Animaciones",
        "order": 2,
        "width": 42,
        "height": "2",
        "format": "<!DOCTYPE html>\n<html lang=\"es\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <title>AnimaciÃ³n con rango 0â€“2000</title>\n  <style>\n    body {\n      margin: 0;\n      position: relative;\n      font-family: sans-serif;\n    }\n\n    .line-bg {\n      stroke: #cccccc;\n      stroke-width: 2;\n      fill: none;\n    }\n\n    .bar {\n      fill: currentColor;\n    }\n\n    .icono-panel,\n    .icono-inversor,\n    .icono-edificio,\n    .icono-grid {\n      position: absolute;\n      top: 0px;\n      width: 80px;\n      height: 80px;\n      z-index: 10;\n      fill: currentColor;\n      color: #cccccc;\n    }\n\n    .icono-panel {\n      left: 1120px;\n      transform: translateX(-50%);\n    }\n\n    .icono-inversor {\n      left: -330px;\n    }\n\n    .icono-edificio {\n      left: 220px;\n      transform: translateX(-50%);\n      font-size: 60px;\n    }\n\n    .icono-grid {\n      left: 2020px;\n      transform: translateX(-50%);\n    }\n  </style>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\">\n</head>\n\n<body>\n  <svg width=\"2220\" height=\"100\">\n    <!-- Primera lÃ­nea (900px) -->\n    <line id=\"lineBg1\" class=\"line-bg\" x1=\"220\" y1=\"40\" x2=\"1120\" y2=\"40\"></line>\n    <rect id=\"bar1\" class=\"bar\" x=\"220\" y=\"37\" width=\"100\" height=\"6\"></rect>\n    <!-- Segunda lÃ­nea (900px) -->\n    <line id=\"lineBg2\" class=\"line-bg\" x1=\"1120\" y1=\"40\" x2=\"2020\" y2=\"40\"></line>\n    <rect id=\"bar2\" class=\"bar\" x=\"1120\" y=\"37\" width=\"100\" height=\"6\"></rect>\n  </svg>\n\n  <!-- Icono de panel solar -->\n  <svg class=\"icono-panel\" viewBox=\"0 0 96 64\">\n    <defs>\n      <linearGradient id=\"grad1\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n        <stop offset=\"0%\" stop-color=\"#4a90e2\" />\n        <stop offset=\"100%\" stop-color=\"#005f9e\" />\n      </linearGradient>\n      <linearGradient id=\"shade1\" x1=\"0%\" y1=\"100%\" x2=\"100%\" y2=\"0%\">\n        <stop offset=\"0%\" stop-color=\"rgba(0,0,0,0.2)\" />\n        <stop offset=\"100%\" stop-color=\"transparent\" />\n      </linearGradient>\n    </defs>\n    <rect x=\"0\" y=\"8\" width=\"96\" height=\"48\" rx=\"4\" ry=\"4\" fill=\"#333\" />\n    <g fill=\"url(#grad1)\">\n      <rect x=\"4\" y=\"12\" width=\"28\" height=\"40\" />\n      <rect x=\"34\" y=\"12\" width=\"28\" height=\"40\" />\n      <rect x=\"64\" y=\"12\" width=\"28\" height=\"40\" />\n    </g>\n    <g stroke=\"rgba(255,255,255,0.3)\" stroke-width=\"1\">\n      <line x1=\"4\" y1=\"24\" x2=\"32\" y2=\"24\" />\n      <line x1=\"4\" y1=\"36\" x2=\"32\" y2=\"36\" />\n      <line x1=\"34\" y1=\"24\" x2=\"62\" y2=\"24\" />\n      <line x1=\"34\" y1=\"36\" x2=\"62\" y2=\"36\" />\n      <line x1=\"64\" y1=\"24\" x2=\"92\" y2=\"24\" />\n      <line x1=\"64\" y1=\"36\" x2=\"92\" y2=\"36\" />\n      <line x1=\"16\" y1=\"12\" x2=\"16\" y2=\"52\" />\n      <line x1=\"48\" y1=\"12\" x2=\"48\" y2=\"52\" />\n      <line x1=\"80\" y1=\"12\" x2=\"80\" y2=\"52\" />\n    </g>\n    <rect x=\"4\" y=\"12\" width=\"28\" height=\"40\" fill=\"url(#shade1)\" />\n    <rect x=\"34\" y=\"12\" width=\"28\" height=\"40\" fill=\"url(#shade1)\" />\n    <rect x=\"64\" y=\"12\" width=\"28\" height=\"40\" fill=\"url(#shade1)\" />\n  </svg>\n\n  <!-- Icono de inversor -->\n  <svg class=\"icono-inversor\" viewBox=\"0 0 48 48\">\n    <path d=\"M24 4l-8 14h16l-8-14zm0 40l8-14h-16l8 14zM4 24h14l-8-16 8-16zm40 0h-14l8-16-8-16z\" />\n  </svg>\n\n  <!-- Icono de edificio -->\n  <i class=\"fa fa-building icono-edificio\"></i>\n\n  <!-- Icono de red elÃ©ctrica -->\n  <svg class=\"icono-grid\" viewBox=\"0 0 64 64\">\n    <defs>\n      <linearGradient id=\"gradGrid\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n        <stop offset=\"0%\" stop-color=\"#A0A0A0\" />\n        <stop offset=\"100%\" stop-color=\"#606060\" />\n      </linearGradient>\n    </defs>\n    <path d=\"M32 2 L32 12 M22 12 L42 12 M32 12 L32 22\" stroke=\"currentColor\" stroke-width=\"4\" fill=\"none\" />\n    <rect x=\"10\" y=\"22\" width=\"44\" height=\"30\" rx=\"5\" ry=\"5\" fill=\"url(#gradGrid)\" stroke=\"black\" stroke-width=\"1\" />\n    <path d=\"M20 30 L20 44 M32 30 L32 44 M44 30 L44 44 M26 37 L38 37\" stroke=\"#E0E0E0\" stroke-width=\"3\" fill=\"none\" />\n    <path d=\"M32 52 L32 62 M22 62 L42 62\" stroke=\"currentColor\" stroke-width=\"4\" fill=\"none\" />\n  </svg>\n\n  <script>\n    (function(scope) {\n      // â€”â€”â€” HORQUILLA: 0 < v â‰¤ 2000 â€”â€”â€”\n      const MIN_DURATION_MS = 1000;   // velocidad MÃXIMA (v=2000)\n      const MAX_DURATION_MS = 10000;  // velocidad MÃNIMA (vâ†’0+)\n      const THRESHOLD = 2000;         // valor de corte\n      // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n      let anim1 = null, start1 = null, dur1 = MAX_DURATION_MS;\n      let anim2 = null, start2 = null, dur2 = MAX_DURATION_MS;\n\n      const bar1 = document.getElementById('bar1'),\n            line1 = document.getElementById('lineBg1'),\n            bar2 = document.getElementById('bar2'),\n            line2 = document.getElementById('lineBg2'),\n            icoPanel = document.querySelector('.icono-panel'),\n            icoEdif  = document.querySelector('.icono-edificio'),\n            icoGrid  = document.querySelector('.icono-grid');\n\n      const len1 = +bar1.getAttribute('width'),\n            x1a = +line1.getAttribute('x1'),\n            x1b = +line1.getAttribute('x2'),\n            dist1 = (x1b - x1a) - len1;\n\n      const len2 = +bar2.getAttribute('width'),\n            x2a = +line2.getAttribute('x1'),\n            x2b = +line2.getAttribute('x2'),\n            dist2 = (x2b - x2a) - len2;\n\n      function paso1(ts) {\n        if (!start1) start1 = ts;\n        const p = ((ts - start1) % dur1) / dur1;\n        bar1.setAttribute('x', (x1b - len1) - dist1 * p);\n        anim1 = requestAnimationFrame(paso1);\n      }\n\n      function paso2(ts) {\n        if (!start2) start2 = ts;\n        const p = ((ts - start2) % dur2) / dur2;\n        bar2.setAttribute('x', x2a + dist2 * p);\n        anim2 = requestAnimationFrame(paso2);\n      }\n\n      scope.$watch('msg', function(msg) {\n        if (!msg || !msg.payload || !msg.payload[0]) {\n          cancelAnimationFrame(anim1);\n          cancelAnimationFrame(anim2);\n          bar1.style.color = bar2.style.color = 'transparent';\n          icoPanel.style.color = icoEdif.style.color = icoGrid.style.color = '#cccccc';\n          return;\n        }\n\n        // Extraer Ãºltima entrada real â‰  0\n        const arr0 = msg.payload[0].data[0],\n              arr1 = msg.payload[0].data[1];\n        function getLastValue(a) {\n          for (let i = a.length - 1; i >= 0; i--) {\n            if (a[i] != null && a[i] !== 0) return a[i];\n          }\n          return 0;\n        }\n        let v1 = getLastValue(arr0),\n            v2 = getLastValue(arr1);\n\n        // Clamp 0 < v â‰¤ 2000\n        v1 = Math.max(0, Math.min(THRESHOLD, v1));\n        v2 = Math.max(0, Math.min(THRESHOLD, v2));\n\n        // DuraciÃ³n lineal entre MAX_DURATION_MS (vâ†’0+) y MIN_DURATION_MS (v=2000)\n        const nd1 = MIN_DURATION_MS + (THRESHOLD - v1) / THRESHOLD * (MAX_DURATION_MS - MIN_DURATION_MS);\n        const nd2 = MIN_DURATION_MS + (THRESHOLD - v2) / THRESHOLD * (MAX_DURATION_MS - MIN_DURATION_MS);\n\n        const a1 = v1 > 0,\n              a2 = v2 > 0;\n\n        // Barra 1: amarilloâ†’rojo\n        if (a1) {\n          if (!anim1 || Math.abs(nd1 - dur1) > 50) {\n            cancelAnimationFrame(anim1);\n            dur1 = nd1; start1 = null;\n            bar1.setAttribute('x', x1b - len1);\n            anim1 = requestAnimationFrame(paso1);\n          }\n        } else {\n          cancelAnimationFrame(anim1);\n          anim1 = null;\n          bar1.style.color = 'transparent';\n        }\n\n        // Barra 2: blancoâ†’azul\n        if (a2) {\n          if (!anim2 || Math.abs(nd2 - dur2) > 50) {\n            cancelAnimationFrame(anim2);\n            dur2 = nd2; start2 = null;\n            bar2.setAttribute('x', x2a);\n            anim2 = requestAnimationFrame(paso2);\n          }\n        } else {\n          cancelAnimationFrame(anim2);\n          anim2 = null;\n          bar2.style.color = 'transparent';\n        }\n\n        // Colorear segÃºn proporciÃ³n v/2000\n        const p1 = v1 / THRESHOLD,\n              p2 = v2 / THRESHOLD;\n        if (a1) bar1.style.color = `rgb(255, ${Math.round(255 - 255*p1)}, ${Math.round(150 - 150*p1)})`;\n        if (a2) bar2.style.color = `rgb(${Math.round(255*(1-p2))}, ${Math.round(255*(1-p2))}, 255)`;\n\n        // Iconos\n        icoPanel.style.color   = v1  > 0 ? '#ffff00' : '#cccccc';\n        icoEdif .style.color   = (msg.consumo||0)   > 0 ? 'orange'   : '#cccccc';\n        let gc = '#cccccc';\n        if ((msg.grid_power||0) > 0) gc = '#4dabf7';\n        else if ((msg.grid_power||0) < 0) gc = '#ff7f0e';\n        icoGrid.style.color = gc;\n      });\n    })(typeof scope !== 'undefined' ? scope : undefined);\n  </script>\n</body>\n\n</html>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "CSS_Anima",
        "x": 2030,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "6d5655c24320f762",
        "type": "debug",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2020,
        "y": 480,
        "wires": []
    },
    {
        "id": "41ef5e6f770811db",
        "type": "ui_chart",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "GRAF_CONSUMO",
        "group": "0a6525c364ecabac",
        "order": 1,
        "width": 40,
        "height": "15",
        "label": "PRODUCCIÃ“N",
        "chartType": "bar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "200",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#fad966",
            "#999999",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "CSS_Graf_Consumo",
        "x": 2030,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "80aec98ec71fd81a",
        "type": "comment",
        "z": "2712839e4de2d960",
        "g": "ba3398c131b492c3",
        "name": "Grupo Estilos",
        "info": "Este nodo Template permite editar libremente en CSS el fondo\ndel dashboard.",
        "x": 970,
        "y": 60,
        "wires": []
    },
    {
        "id": "2eb7b242fa01841f",
        "type": "ui_template",
        "z": "2712839e4de2d960",
        "g": "ba3398c131b492c3",
        "group": "0a6525c364ecabac",
        "name": "CSS_Imagen_Cuerva",
        "order": 7,
        "width": "33",
        "height": "1",
        "format": "<style>\n    /* Establece los estilos para el elemento <body> (la pÃ¡gina completa) */\n    body {\n        /* Especifica la imagen de fondo que se utilizarÃ¡ en la pÃ¡gina */\n        background-image: url('/IMAGEN_FONDO_METEO.png');\n\n        /* Hace que la imagen de fondo cubra toda el Ã¡rea del fondo, ajustÃ¡ndose al tamaÃ±o de la ventana */\n        background-size: cover;\n\n        /* Centra la imagen de fondo tanto en el eje horizontal como vertical */\n        background-position: center;\n\n        /* Evita que la imagen de fondo se repita si no cubre toda el Ã¡rea visible */\n        background-repeat: no-repeat;\n    }\n</style>\n\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1220,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "e67f099aa8cac4cf",
        "type": "inject",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Reloj_Email",
        "props": [],
        "repeat": "",
        "crontab": "59 23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 990,
        "y": 960,
        "wires": [
            [
                "2895484c0427f6fa"
            ]
        ]
    },
    {
        "id": "2895484c0427f6fa",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Consulta_MYSQL",
        "func": "msg.topic = \"SELECT id, fecha, E_Consumido_Direct, E_Suministrada_RED FROM Consumos WHERE DATE(fecha) = CURDATE();\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 960,
        "wires": [
            [
                "968bce566a51f483"
            ]
        ]
    },
    {
        "id": "f6f619f0448031fb",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "TABLA_HTML_Fotovoltaica_UNI_Madrid",
        "func": "// Inicia la variable con la estructura bÃ¡sica del HTML y la tabla\n// Actualizado para Consumos\nvar html = `<html>\nÂ  <head>\nÂ  Â  <meta charset=\"UTF-8\">\nÂ  Â  <style>\nÂ  Â  Â  table { border-collapse: collapse; width: 100%; }\nÂ  Â  Â  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }\nÂ  Â  Â  th { background-color: #f2f2f2; }\nÂ  Â  </style>\nÂ  </head>\nÂ  <body>\nÂ  Â  <h2>Datos Consumos</h2> Â  Â  <table>\nÂ  Â  Â  <tr>\nÂ  Â  Â  Â  <th>id</th>\nÂ  Â  Â  Â  <th>fecha</th>\nÂ  Â  Â  Â  <th>E_Consumido_Direct</th> Â  Â  Â  Â  <th>E_Suministrada_RED</th> Â  Â  Â  </tr>`;\n\n// Asegurarse de que msg.payload sea un array antes de iterar\nconst rows = Array.isArray(msg.payload) ? msg.payload : [];\n\n// Recorre cada registro obtenido de la consulta y agrega una fila a la tabla\nrows.forEach(function(row) {\n    // AÃ±adimos una verificaciÃ³n bÃ¡sica para asegurarnos de que la fila no es null/undefined\n    if (row) {\nÂ  Â  html += `<tr>\nÂ  Â  Â  <td>${row.id !== undefined && row.id !== null ? row.id : ''}</td>\nÂ  Â  Â  <td>${row.fecha !== undefined && row.fecha !== null ? row.fecha : ''}</td>\nÂ  Â  Â  <td>${row.E_Consumido_Direct !== undefined && row.E_Consumido_Direct !== null ? row.E_Consumido_Direct : ''}</td> Â  Â  Â  <td>${row.E_Suministrada_RED !== undefined && row.E_Suministrada_RED !== null ? row.E_Suministrada_RED : ''}</td> Â  Â  </tr>`;\n    }\n});\n\nhtml += `</table>\nÂ  </body>\n</html>`;\n\n// Asigna el HTML generado al payload\nmsg.payload = html;\n\n// Establece el asunto del correo (Actualizado para Consumos)\nmsg.topic = \"Datos Consumos*\"; // Cambiado para reflejar el nuevo origen de datos\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 960,
        "wires": [
            [
                "6bfa28b54d55b8ef",
                "bb30ecb042f62688"
            ]
        ]
    },
    {
        "id": "6bfa28b54d55b8ef",
        "type": "e-mail",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "server": "smtp.gmail.com",
        "port": "465",
        "authtype": "BASIC",
        "saslformat": true,
        "token": "oauth2Response.access_token",
        "secure": true,
        "tls": false,
        "name": "plecoq@cuervaenergia.com",
        "dname": "Datos_FOTOVOLTAICA_UN_MADRID",
        "x": 2490,
        "y": 960,
        "wires": []
    },
    {
        "id": "5cd7e5a7fa3ae97d",
        "type": "comment",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Grupo Reportes",
        "info": "Este grupo envÃ­a los datos recogidos por \nlos sensores y almacenados en MYSQL a un correo \nelectrÃ³nico configurado",
        "x": 990,
        "y": 800,
        "wires": []
    },
    {
        "id": "bb30ecb042f62688",
        "type": "debug",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Datos_Email_FOTOVOLTAICA_UN_MADRID",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1780,
        "y": 1020,
        "wires": []
    },
    {
        "id": "518bc6419c455688",
        "type": "xlsx-out",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Excel_FOTOVOLTAICA_UN_MADRID",
        "sheetName": "Consumos",
        "x": 2110,
        "y": 920,
        "wires": [
            [
                "6bfa28b54d55b8ef"
            ]
        ]
    },
    {
        "id": "9ca92545bcb3112e",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Formateo_XLSX",
        "func": "// msg.payload contiene los datos obtenidos de la base de datos\nlet data = msg.payload;\n\n// Asegurarse de que data es un array antes de intentar .map()\nif (!Array.isArray(data)) {\n    node.error(\"Input payload is not an array\", msg);\n    // Si el payload no es un array (por ejemplo, una fila Ãºnica o un error),\n    // puedes decidir si quieres pasar un array vacÃ­o o detener el flujo.\n    // AquÃ­ pasamos un array vacÃ­o para evitar errores en nodos posteriores.\n    data = [];\n}\n\n\n// Transformar los datos en un array de objetos con las nuevas columnas\nlet excelData = data.map(row => ({\nÂ  Â  // Usamos los nuevos nombres de columna para las propiedades del objeto\nÂ  Â  E_Consumido_Direct: row.E_Consumido_Direct,\nÂ  Â  E_Suministrada_RED: row.E_Suministrada_RED\n}));\n\nmsg.payload = excelData;\n\n// Establece el asunto del correo (sugerencia basada en el nuevo origen de datos)\nmsg.topic = \"Datos Consumos*\"; // Cambiado para reflejar el nuevo origen de datos\n\n// Establece el nombre del archivo (sugerencia basada en el nuevo origen de datos)\nmsg.filename = \"Datos_Consumos*.xlsx\"; // Cambiado para reflejar el nuevo origen de datos\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1680,
        "y": 920,
        "wires": [
            [
                "1b5fc013da142ca2",
                "518bc6419c455688"
            ]
        ]
    },
    {
        "id": "1b5fc013da142ca2",
        "type": "debug",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Datos_FOTOVOLTAICA_UN_MADRID_XLSX",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1800,
        "y": 860,
        "wires": []
    },
    {
        "id": "9c94e6c47e045cc6",
        "type": "comment",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "Grupo Control/VisualizaciÃ³n",
        "info": "Este grupo controla la visualizaciÃ³n,\n gestiÃ³n y almacenamiento\n  de los datos",
        "x": 1020,
        "y": 280,
        "wires": []
    },
    {
        "id": "79ac5da96863155c",
        "type": "ui_template",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "group": "0a6525c364ecabac",
        "name": "Selector_Fecha",
        "order": 6,
        "width": "11",
        "height": "6",
        "format": "<style>\n  .period-picker {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    padding: 0.1rem;\n    background-color: #2c2c2c;\n    border-radius: 0.75rem;\n    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.5);\n    font-family: 'Helvetica Neue', Arial, sans-serif;\n    color: #e0e0e0;\n    max-width: 400px;\n    margin: 1rem;\n  }\n\n  .period-picker__radios {\n    display: flex;\n    justify-content: space-between;\n    width: 100%;\n    margin-bottom: 0.3rem;\n  }\n\n  .period-picker__radios label {\n    font-size: 0.9rem;\n    cursor: pointer;\n    padding: 0.3rem 0.8rem;\n    border-radius: 0.35rem;\n    background-color: #2e2e3e;\n    color: #ccc;\n    transition: all 0.3s;\n  }\n\n  .period-picker__radios input[type=\"radio\"] {\n    display: none;\n  }\n\n  .period-picker__radios input[type=\"radio\"]:checked+label {\n    background-color: #4a90e2;\n    color: #fff;\n  }\n\n  .period-picker__wrapper {\n    position: relative;\n    width: 85%;\n    margin-bottom: 0.8rem;\n  }\n\n  .period-picker__icon {\n    position: absolute;\n    left: 0.6rem;\n    top: 50%;\n    transform: translateY(-50%);\n    font-size: 1.1rem;\n    color: #4a90e2;\n    pointer-events: none;\n  }\n\n  .period-picker__wrapper::after {\n    content: 'â–¼';\n    position: absolute;\n    right: 0.6rem;\n    top: 50%;\n    transform: translateY(-50%);\n    font-size: 0.75rem;\n    color: #aaa;\n    pointer-events: none;\n  }\n\n  .period-picker__input {\n    width: 100%;\n    padding: 0.35rem 1.7rem;\n    border: 1px solid #444;\n    border-radius: 0.4rem;\n    font-size: 0.85rem;\n    text-align: center;\n    background-color: #2a2a3b;\n    color: #e0e0e0;\n    appearance: none;\n    -webkit-appearance: none;\n  }\n\n  .period-picker__input:focus {\n    outline: none;\n    border-color: #4a90e2;\n    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.4);\n    background-color: #33334a;\n  }\n\n  .period-picker__input::-webkit-calendar-picker-indicator {\n    opacity: 0;\n    cursor: pointer;\n  }\n\n  .period-picker__wrapper--no-arrow::after {\n    content: none;\n  }\n</style>\n\n<div class=\"period-picker\" ng-init=\"periodType='month'\">\n  Â  Â  <div class=\"period-picker__radios\">\n    Â  Â  <input type=\"radio\" id=\"year\" ng-model=\"periodType\" value=\"year\">\nÂ  Â  <label for=\"year\" ng-click=\"send({ payload: anioSeleccionadoISO, period: 'year' })\">AÃ±o</label>\n\n    Â  Â  <input type=\"radio\" id=\"month\" ng-model=\"periodType\" value=\"month\">\nÂ  Â  <label for=\"month\" ng-click=\"send({ payload: mesSeleccionado, period: 'month' })\">Mes</label>\n\n    Â  Â  <input type=\"radio\" id=\"week\" ng-model=\"periodType\" value=\"week\">\nÂ  Â  <label for=\"week\" ng-click=\"send({ payload: semanaSeleccionada, period: 'week' })\">Semana</label>\n\n    Â  Â  <input type=\"radio\" id=\"day\" ng-model=\"periodType\" value=\"day\">\nÂ  Â  <label for=\"day\" ng-click=\"send({ payload: diaSeleccionada, period: 'day' })\">DÃ­a</label>\n    Â  </div>\n\n  Â  Â  <div ng-show=\"periodType==='year'\" class=\"period-picker__wrapper period-picker__wrapper--no-arrow\">\n    Â  Â  <i class=\"period-picker__icon\">ğŸ“…</i>\n    Â  Â  <input\nÂ  Â  Â  type=\"number\"\nÂ  Â  Â  min=\"1900\"\nÂ  Â  Â  max=\"2100\"\nÂ  Â  Â  step=\"1\"\nÂ  Â  Â  placeholder=\"YYYY\"\nÂ  Â  Â  ng-model=\"anioSeleccionado\"\nÂ  Â  Â  ng-change=\"anioSeleccionadoISO = (anioSeleccionado ? (anioSeleccionado + '-01-01') : null); send({ payload: anioSeleccionadoISO, period: periodType })\"\nÂ  Â  Â  class=\"period-picker__input\"\nÂ  Â  />\nÂ  </div>\n\n  Â  Â  <div ng-show=\"periodType==='month'\" class=\"period-picker__wrapper\">\n    Â  Â  <i class=\"period-picker__icon\">ğŸ“…</i>\n    Â  Â  <input\nÂ  Â  Â  type=\"month\"\nÂ  Â  Â  ng-model=\"mesSeleccionado\"\nÂ  Â  Â  ng-change=\"send({ payload: mesSeleccionado, period: periodType })\"\nÂ  Â  Â  class=\"period-picker__input\"\nÂ  Â  />\nÂ  </div>\n\n  Â  Â  <div ng-show=\"periodType==='week'\" class=\"period-picker__wrapper\">\n    Â  Â  <i class=\"period-picker__icon\">ğŸ“…</i>\n    Â  Â  <input\nÂ  Â  Â  type=\"week\"\nÂ  Â  Â  ng-model=\"semanaSeleccionada\"\nÂ  Â  Â  ng-change=\"send({ payload: semanaSeleccionada, period: periodType })\"\nÂ  Â  Â  class=\"period-picker__input\"\nÂ  Â  />\nÂ  </div>\n\n  Â  Â  <div ng-show=\"periodType==='day'\" class=\"period-picker__wrapper\">\n    Â  Â  <i class=\"period-picker__icon\">ğŸ“…</i>\n    Â  Â  <input\nÂ  Â  Â  type=\"date\"\nÂ  Â  Â  ng-model=\"diaSeleccionada\"\nÂ  Â  Â  ng-change=\"send({ payload: diaSeleccionada, period: periodType })\"\n      ng-click=\"send({ payload: diaSeleccionada, period: periodType })\"  Â  Â  Â  class=\"period-picker__input\"\nÂ  Â  />\nÂ  </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 980,
        "y": 480,
        "wires": [
            [
                "cbcffaba4f2a5fe1"
            ]
        ]
    },
    {
        "id": "53ea2fd20daf41b8",
        "type": "ui_template",
        "z": "2712839e4de2d960",
        "d": true,
        "g": "ba3398c131b492c3",
        "group": "0a6525c364ecabac",
        "name": "CSS_Selector_Dia",
        "order": 8,
        "width": "30",
        "height": "1",
        "format": "<style>\n  /* Contenedor general centrado y bajado 7px */\n  .CSS_Selector_dia {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 7px;\n    /* <-- Cambiado a 7px */\n  }\n\n  /* Input con fondo blanco, texto negro, bordes redondeados */\n  .CSS_Selector_dia input {\n    background-color: #ffffff !important;\n    color: #000000 !important;\n    border: 1px solid #ccc;\n    border-radius: 0.5rem;\n    padding: 0.5rem;\n    font-size: 1rem;\n    box-sizing: border-box;\n    width: auto;\n    min-width: 150px;\n    text-align: center;\n  }\n\n  /* Placeholder si aplica */\n  .CSS_Selector_dia input::placeholder {\n    color: #888 !important;\n  }\n</style>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1210,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "6d977a5c73cafa31",
        "type": "ui_template",
        "z": "2712839e4de2d960",
        "g": "ba3398c131b492c3",
        "group": "0a6525c364ecabac",
        "name": "CSS_Reportes",
        "order": 4,
        "width": "8",
        "height": "11",
        "format": "<!-- Contenedor principal -->\n<div class=\"card mx-auto my-5 text-center\" id=\"report-card\">\n  <div class=\"card-body p-4 d-flex flex-column align-items-center\">\n    <h5 class=\"card-title text-accent mb-4\">Generador de Reportes</h5>\n\n    <!-- Selector de rango -->\n    <div class=\"mb-4 w-100\">\n      <label for=\"rango\" class=\"form-label fw-semibold\">Selecciona el perÃ­odo:</label>\n      <select id=\"rango\" class=\"form-select form-select-dark text-center\" onchange=\"toggleDateInput()\">\n        <option value=\"dia\">DÃ­a completo</option>\n        <option value=\"mes\">Mes completo</option>\n      </select>\n    </div>\n\n    <!-- Selector para dÃ­a -->\n    <div class=\"mb-4 w-100\" id=\"fechaDiaGroup\">\n      <label for=\"fechaDia\" class=\"form-label\">Selecciona un dÃ­a:</label>\n      <input type=\"date\" id=\"fechaDia\" class=\"form-control form-control-dark text-center\" required>\n    </div>\n\n    <!-- Selector para mes -->\n    <div class=\"mb-4 w-100\" id=\"fechaMesGroup\" style=\"display: none;\">\n      <label for=\"fechaMes\" class=\"form-label\">Selecciona un mes:</label>\n      <input type=\"month\" id=\"fechaMes\" class=\"form-control form-control-dark text-center\" required>\n    </div>\n\n    <!-- BotÃ³n de descarga -->\n    <button onclick=\"descargarDatos()\" class=\"btn btn-accent w-100 py-2\">\n      <i class=\"fa fa-download me-2\"></i> Generar Reporte\n    </button>\n  </div>\n</div>\n\n<style>\n  :root {\n    --bg-page: #33334a;\n    --bg-card: #33334a;\n    --text-main: #e0e0e0;\n    --text-muted: #a0a0a0;\n    --accent: #4a90e2;\n    --accent-hover: #357ABD;\n    --input-bg: #33334a;\n    --input-border: #33334a;\n    --input-focus: #4a90e2;\n    --input-focus-shadow: rgba(74, 144, 226, 0.4);\n    --btn-hover-shadow: rgba(0, 0, 0, 0.4);\n  }\n\n  body {\n    background-color: var(--bg-page);\n    color: var(--text-main);\n    font-family: \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n  }\n\n  #report-card {\n    max-width: 350px;\n    /* Ancho reducido para un recuadro mÃ¡s estrecho */\n    height: 170px;\n    /* Altura del contenedor */\n    background-color: #2c2c2c;\n    /* Nuevo color de fondo */\n    border-radius: 1rem;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n    text-align: center;\n  }\n\n  .card-title {\n    color: var(--accent);\n    font-size: 1.25rem;\n  }\n\n  .form-label {\n    color: var(--text-main);\n    font-size: 0.9rem;\n  }\n\n  .form-label.fw-semibold {\n    font-weight: 600;\n  }\n\n  .form-control-dark,\n  .form-select-dark {\n    background-color: var(--input-bg);\n    border: 1px solid var(--input-border);\n    border-radius: 1rem;\n    color: var(--text-main);\n    transition: box-shadow 0.2s ease, border-color 0.2s ease;\n    text-align: center;\n  }\n\n  .form-control-dark:focus,\n  .form-select-dark:focus {\n    outline: none;\n    border-color: var(--input-focus);\n    box-shadow: 0 0 0 2px var(--input-focus-shadow);\n  }\n\n  .btn-accent {\n    background-color: var(--accent);\n    color: #ffffff;\n    border: none;\n    border-radius: 1rem;\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n  }\n\n  .btn-accent:hover {\n    background-color: var(--accent-hover);\n    transform: translateY(-2px);\n    box-shadow: 0 8px 20px var(--btn-hover-shadow);\n  }\n\n  .btn-accent i {\n    vertical-align: middle;\n  }\n</style>\n\n<script>\n  function toggleDateInput() {\n    const rango = document.getElementById('rango').value;\n    document.getElementById('fechaDiaGroup').style.display = rango === 'dia' ? 'block' : 'none';\n    document.getElementById('fechaMesGroup').style.display = rango === 'mes' ? 'block' : 'none';\n    document.getElementById('fechaDia').value = '';\n    document.getElementById('fechaMes').value = '';\n  }\n\n  function descargarDatos() {\n    const rango = document.getElementById('rango').value;\n    let fechaInicio, fechaFin;\n\n    if (rango === 'dia') {\n      const fecha = document.getElementById('fechaDia').value;\n      if (!fecha) {\n        alert('Por favor selecciona un dÃ­a');\n        return;\n      }\n      fechaInicio = `${fecha}T00:00:00`;\n      fechaFin    = `${fecha}T23:59:59`;\n    } else {\n      const fechaMes = document.getElementById('fechaMes').value;\n      if (!fechaMes) {\n        alert('Por favor selecciona un mes');\n        return;\n      }\n      const [year, month] = fechaMes.split('-');\n      const ultimoDia = new Date(year, month, 0).getDate();\n      fechaInicio = `${year}-${month}-01T00:00:00`;\n      fechaFin    = `${year}-${month}-${String(ultimoDia).padStart(2,'0')}T23:59:59`;\n    }\n\n    window.location.href = `/descargar-excel?inicio=${encodeURIComponent(fechaInicio)}&fin=${encodeURIComponent(fechaFin)}`;\n  }\n\n  (function init() {\n    const today = new Date().toISOString().split('T')[0];\n    document.getElementById('fechaDia').value = today;\n    document.getElementById('fechaMes').value = today.slice(0,7);\n  })();\n</script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1200,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "a36fa9eca0f14f8c",
        "type": "http in",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "",
        "url": "/descargar-excel",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1000,
        "y": 1160,
        "wires": [
            [
                "6e936e0799b6103e"
            ]
        ]
    },
    {
        "id": "fa29f937cfa1a388",
        "type": "http response",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2540,
        "y": 1160,
        "wires": []
    },
    {
        "id": "6e936e0799b6103e",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Consulta_MYSQL",
        "func": "// Obtener fechas del query (ej: ?inicio=2025-04-22T00:00:00&fin=2025-04-22T23:59:59)\nconst fechaInicio = msg.req.query.inicio.replace(\"T\", \" \"); Â // Formato: '2025-04-22 00:00:00'\nconst fechaFin = msg.req.query.fin.replace(\"T\", \" \"); Â  Â  Â  Â // Formato: '2025-04-22 23:59:59'\n\n// Construir consulta SIN parÃ¡metros (como en tu ejemplo funcional)\n// Actualizado para seleccionar las nuevas columnas de la tabla Consumos\nmsg.topic = `\nÂ  SELECT fecha, E_Consumido_Direct, E_Suministrada_RED\nÂ  Â  FROM Consumos\nÂ  Â WHERE fecha >= '${fechaInicio}'\nÂ  Â  Â AND fecha <= '${fechaFin}'\nÂ  Â ORDER BY fecha\n`;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 1160,
        "wires": [
            [
                "944af3f5821a881c",
                "5100f29857b7e882"
            ]
        ]
    },
    {
        "id": "6d8910b10fc02638",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Formateo_XLSX",
        "func": "// msg.payload: array de objetos con { fecha, E_Consumido_Direct, E_Suministrada_RED } // Comentario actualizado\nlet data = msg.payload;\n\nlet excelData = data.map(row => {\nÂ  Â  // parsear la fecha ISO a objeto Date\nÂ  Â  const d = new Date(row.fecha);\nÂ  Â  // formatear a â€œdd/mm/yyyy hh:MM:ssâ€\nÂ Â  Â const fechaHora = d.toLocaleString('es-ES', {\nÂ Â  Â  Â  Â  day: '2-digit',\nÂ Â  Â  Â  Â  month: '2-digit',\nÂ Â  Â  Â  Â  year: 'numeric',\nÂ Â  Â  Â  Â  hour: '2-digit',\nÂ Â  Â  Â  Â  minute: '2-digit',\nÂ Â  Â  Â  Â  second: '2-digit',\nÂ Â  Â  Â  Â  hour12: false\nÂ Â  Â });\nÂ  Â  return {\nÂ  Â  Â  Â  FechaHora: fechaHora, // La columna de fecha/hora formateada\nÂ  Â  Â  Â  E_Consumido_Direct: row.E_Consumido_Direct, // Columna actualizada\nÂ  Â  Â  Â  E_Suministrada_RED: row.E_Suministrada_RED Â // Columna actualizada\nÂ  Â  };\n});\n\nmsg.payload = excelData;\n\n// Establece el asunto (Actualizado segÃºn tu indicaciÃ³n)\nmsg.topic = \"Consumos Fotovoltaica Universidad de Madrid\";\n\n// Nombre del archivo (se mantiene como en tu cÃ³digo original)\nmsg.filename = \"Datos_FOTOV_UNI_MADRID.xlsx\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 1160,
        "wires": [
            [
                "82cda4b23e81bef8"
            ]
        ]
    },
    {
        "id": "82cda4b23e81bef8",
        "type": "xlsx-out",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Excel_FOTOVOLTAICA_UN_MADRID",
        "sheetName": "Consumos",
        "x": 2060,
        "y": 1160,
        "wires": [
            [
                "afabf483ebd8d3ad"
            ]
        ]
    },
    {
        "id": "d5a21d2008515361",
        "type": "debug",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 1220,
        "wires": []
    },
    {
        "id": "944af3f5821a881c",
        "type": "debug",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 1220,
        "wires": []
    },
    {
        "id": "afabf483ebd8d3ad",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "name": "Formateo.xlsx",
        "func": "// Obtener fechas desde los parÃ¡metros\nconst fechaInicio = msg.req.query.inicio.split('T')[0]; // Ej: \"2025-04-22\"\nconst fechaFin = msg.req.query.fin.split('T')[0];\n\n// Configurar headers para forzar la descarga como .xlsx\nmsg.headers = {\nÂ  \"Content-Type\": \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\", // MIME type correcto\nÂ  // Nombre del archivo actualizado para reflejar los datos de Consumos\nÂ  \"Content-Disposition\": `attachment; filename=\"Datos_Consumos_${fechaInicio}_a_${fechaFin}.xlsx\"` // Parte del nombre actualizada\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2350,
        "y": 1160,
        "wires": [
            [
                "fa29f937cfa1a388"
            ]
        ]
    },
    {
        "id": "86d6f79577104659",
        "type": "debug",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1800,
        "y": 540,
        "wires": []
    },
    {
        "id": "4f7f84fb02f728f6",
        "type": "delay",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "",
        "pauseType": "delay",
        "timeout": "40",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1250,
        "y": 360,
        "wires": [
            [
                "db5fb5456e5f6a1b"
            ]
        ]
    },
    {
        "id": "ce267b434ea48920",
        "type": "inject",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "ActualizaciÃ³n_Persistente",
        "props": [
            {
                "p": "trigger",
                "v": "true",
                "vt": "bool"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1040,
        "y": 520,
        "wires": [
            [
                "cbcffaba4f2a5fe1"
            ]
        ]
    },
    {
        "id": "cbcffaba4f2a5fe1",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "Consulta_MYSQL",
        "func": "// â”€â”€â”€ Nodo: SQL Gen (polling revisado con parsing de fecha ISO para â€œyearâ€|â€œmonthâ€|â€œweekâ€|â€œdayâ€) â”€â”€â”€\n\n// 1) Recuperar Ãºltimos settings del flujo\nlet settings = flow.get('lastSettings');\n\n// 2) Si viene del date-picker: guardamos payload + period\nif (msg.period !== undefined) {\n  settings = { payload: msg.payload, period: msg.period };\n  flow.set('lastSettings', settings);\n}\n// 3) Si viene del polling (msg.trigger) y no hay settings: salir\nelse if (msg.trigger === true) {\n  if (!settings) {\n    node.warn(\"Polling ignorado: sin selecciÃ³n previa\");\n    return null;\n  }\n}\n// 4) Si no es ni uno ni otro: descartamos\nelse {\n  return null;\n}\n\n// 5) Asignamos msg.payload y msg.period desde settings\nlet payload = settings.payload;\nlet period Â = settings.period;\nmsg.payload = payload;\nmsg.period Â = period;\n\n// 6) Defininiciones SQL\nconst SQL_BY_MONTH = \"DATE_FORMAT(fecha, '%Y-%m')\";\nconst SQL_BY_DAY Â  = \"DATE_FORMAT(fecha, '%Y-%m-%d')\";\nconst SQL_BY_HOUR Â = \"DATE_FORMAT(fecha, '%Y-%m-%d %H:00:00')\";\n\n// FunciÃ³n fmt(d):\n// Siempre devuelve \"YYYY-MM-DD\" en UTC\nfunction fmt(d) {\n  return d.toISOString().slice(0, 10);\n}\n\ntry {\n  // â”€â”€â”€ Normalizo si me llega un objeto Date â”€â”€â”€\n  // Esta parte maneja casos donde msg.payload podrÃ­a ser un objeto Date en lugar de string ISO\n  Â if (payload instanceof Date) {\n    const y = payload.getUTCFullYear();\n    const m = payload.getUTCMonth() + 1; // getUTCMonth es 0-indexed, add 1\n    const d = payload.getUTCDate();\n    if (period === 'month') {\n      // Si es un Date y period 'month', lo convierte a \"YYYY-MM\" string.\n      // NOTA: La compensaciÃ³n de 1 mes se aplica mÃ¡s abajo para el string \"YYYY-MM\"\n      msg.payload = `${y}-${String(m).padStart(2,'0')}`;\n    }\n    else if (period === 'week' || period === 'day') {\n      // Si es un Date y period 'week' o 'day', lo convierte a \"YYYY-MM-DD\" string.\n      // NOTA: La compensaciÃ³n de 1 dÃ­a se aplica mÃ¡s abajo para el string \"YYYY-MM-DD\"\n      msg.payload = `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;\n    }\n    // Actualizamos la variable local 'payload' con el string formateado para el switch()\n    payload = msg.payload;\n  }\n\n\n  let startDate, endDate, groupBy;\n\n  switch (period) {\n\n    case 'year': {\n      const raw = String(payload); // payload esperado: \"YYYY-MM-DD\" (aunque solo se usa)\n      const y = parseInt(raw.split('-')[0], 10);\n      if (isNaN(y)) throw new Error(`AÃ±o invÃ¡lido: ${payload}`);\n      startDate = new Date(Date.UTC(y, 0, 1));\n      endDate Â  = new Date(Date.UTC(y, 11, 31, 23, 59, 59));\n      groupBy Â  = SQL_BY_MONTH;\n      break;\n    }\n\n    case 'month': {\n      // Asumimos que el payload \"YYYY-MM\" es 1 mes ANTES del mes deseado.\n      const [y_in, m_in] = String(payload).split('-').map(n => parseInt(n, 10));\n      if (isNaN(y_in) || isNaN(m_in)) throw new Error(`Mes invÃ¡lido: ${payload}`);\n\n      let m_intended = m_in + 1;\n      let y_intended = y_in;\n\n      if (m_intended > 12) {\n        m_intended = 1;\n        y_intended += 1;\n      }\n\n      startDate = new Date(Date.UTC(y_intended, m_intended - 1, 1));\n      endDate Â  = new Date(Date.UTC(y_intended, m_intended, 0, 23, 59, 59));\n\n      groupBy Â  = SQL_BY_DAY;\n      break;\n    }\n\n    case 'week': {\n      const [y, m, d] = String(payload).split('-').map(n => parseInt(n, 10));\n      if (isNaN(y) || isNaN(m) || isNaN(d)) throw new Error(`Fecha invÃ¡lida: ${payload}`);\n      const base = new Date(Date.UTC(y, m - 1, d)); // Crea una fecha en UTC para el dÃ­a recibido\n      const dow Â = base.getUTCDay(); // DÃ­a de la semana UTC (0=Dom, 1=Lun...)\n      // Calcula la diferencia para ir al lunes de esa semana (lunes es dÃ­a 1, domingo es 0 aquÃ­).\n      // Si dow es 0 (domingo), diff = -6 para ir al lunes anterior.\n      // Si dow es 1 (lunes), diff = 1 - 1 = 0.\n      // Si dow es 6 (sÃ¡bado), diff = 1 - 6 = -5 (para ir al lunes).\n      const diff = dow === 0 ? -6 : 1 - dow;\n\n      startDate = new Date(base); // Copia la fecha base\n      startDate.setUTCDate(base.getUTCDate() + diff); // Ajusta al lunes de la semana en UTC\n      endDate Â  = new Date(startDate); // Copia el lunes\n      endDate.setUTCDate(startDate.getUTCDate() + 6); // Avanza 6 dÃ­as para llegar al domingo en UTC\n      groupBy Â  = SQL_BY_DAY;\n      break;\n    }\n\n    case 'day': {\n      const [Y_in, M_in, D_in] = String(payload).split('-').map(n => parseInt(n, 10));\n      if (isNaN(Y_in) || isNaN(M_in) || isNaN(D_in)) throw new Error(`Fecha invÃ¡lida: ${payload}`);\n\n      // --- INICIO DEL CAMBIO ---\n      // Asumimos que el dÃ­a recibido (Y_in-M_in-D_in) es 1 dÃ­a ANTES del dÃ­a deseado.\n      // Creamos un objeto Date en UTC para el dÃ­a recibido.\n      let receivedDate = new Date(Date.UTC(Y_in, M_in - 1, D_in)); // M_in es 1-indexed, M_in-1 es 0-indexed mes\n\n      // AÃ±adimos 1 dÃ­a a este objeto Date. setUTCDate maneja automÃ¡ticamente los cambios de mes y aÃ±o en UTC.\n      receivedDate.setUTCDate(receivedDate.getUTCDate() + 1);\n\n      // Formateamos la fecha CORREGIDA de vuelta a string-MM-DD\n      const correctedDayStr = fmt(receivedDate);\n      // --- FIN DEL CAMBIO ---\n\n      msg.topic =\n        `SELECT\n          Â Â Â Â ${SQL_BY_HOUR} AS periodo,\n          Â Â Â Â SUM(E_Consumido_Direct) AS E_Consumido_Direct,\n          Â Â Â Â SUM(E_Suministrada_RED) AS E_Suministrada_RED\n          Â FROM Consumos\n          Â WHERE fecha BETWEEN '${correctedDayStr} 00:00:00' AND '${correctedDayStr} 23:59:59'\n          Â GROUP BY 1\n          Â ORDER BY 1`\n        .replace(/\\s+/g,' ').trim();\n\n      msg.selected_period = 'day';\n      // Usamos el dÃ­a corregido para startDate y endDate en el msg de salida\n      msg.startDate Â  Â  Â  = correctedDayStr;\n      msg.endDate Â  Â  Â  Â  = correctedDayStr;\n      delete msg.payload; // El payload original (probablemente incorrecto) no se envÃ­a al siguiente nodo\n      return msg; // Retorna directamente para el caso 'day' ya que la consulta se genera aquÃ­\n    }\n\n    default:\n      throw new Error(`Unknown period: ${period}`);\n  }\n\n  // Para 'year', 'month' o 'week'\n  // La consulta se genera despuÃ©s del switch, usando startDate y endDate calculados arriba\n  msg.topic =\n    `SELECT\n      Â Â Â Â ${groupBy} AS periodo,\n      Â Â Â Â SUM(E_Consumido_Direct) AS E_Consumido_Direct,\n      Â Â Â Â SUM(E_Suministrada_RED) AS E_Suministrada_RED\n      Â FROM Consumos\n      Â WHERE fecha BETWEEN '${fmt(startDate)} 00:00:00' AND '${fmt(endDate)} 23:59:59'\n      Â GROUP BY 1\n      Â ORDER BY 1`\n    .replace(/\\s+/g,' ').trim();\n\n  msg.selected_period = period;\n  msg.startDate Â  Â  Â  = fmt(startDate); // Aseguramos que el output msg.startDate/endDate sea-MM-DD del rango calculado\n  msg.endDate Â  Â  Â  Â  = fmt(endDate);\n  delete msg.payload;\n  return msg;\n\n} catch (err) {\n  node.error(`SQL Gen Error: ${err.message}`, msg);\n  return null;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 480,
        "wires": [
            [
                "f1e5d6761ba3dc38"
            ]
        ]
    },
    {
        "id": "8080b13d4e3a0db0",
        "type": "function",
        "z": "2712839e4de2d960",
        "g": "76c0e9f2c89dabb0",
        "name": "ConversiÃ³n_Datos",
        "func": "// Nodo: ConversiÃ³n a Chart (Actualizado para Consumos)\n// Entrada: msg.payload = array de filas [{periodo, E_Consumido_Direct, E_Suministrada_RED}, â€¦]\n// Â  Â  Â  Â  Â msg.selected_period ('year'|'month'|'week'|'day')\n// Â  Â  Â  Â  Â msg.startDate, msg.endDate (\"YYYY-MM-DD\") - Representan el rango REAL del periodo\n// Salida: msg.payload = [ { series: [...], data: [...], labels: [...] } ]\n\nconst rows = Array.isArray(msg.payload) ? msg.payload : [];\nconst periodType = msg.selected_period;\nconst startDate = msg.startDate;\nconst endDate = msg.endDate;\n\n// Verificar que tenemos datos necesarios\nif (!periodType || !startDate || !endDate) {\nÂ  Â  node.error(\"Faltan datos para la conversiÃ³n a Chart (periodType, startDate, endDate).\", msg);\nÂ  Â  return null;\n}\n\n// Genera array completo de periodos/etiquetas esperados para el eje X\nfunction genPeriods(start, end, type) {\nÂ  Â  let list = [];\nÂ  Â  let s, e, cur;\n\nÂ  Â  try {\nÂ  Â  Â  Â  // 1) Parseamos las fechas en UTC aÃ±adiendo Z para asegurar UTC\nÂ  Â  Â  Â  s = new Date(start + 'T00:00:00Z');\nÂ  Â  Â  Â  e = new Date(end Â  + 'T00:00:00Z');\nÂ  Â  Â  Â  if (isNaN(s) || isNaN(e)) throw new Error(\"Fechas de inicio/fin invÃ¡lidas.\");\nÂ  Â  Â  Â  cur = new Date(s); // Copia para iterar\nÂ  Â  } catch (err) {\nÂ  Â  Â  Â  node.error(`Error parseando fechas en genPeriods: ${err.message}`);\nÂ  Â  Â  Â  return []; // Devuelve lista vacÃ­a si hay error\nÂ  Â  }\n\n\nÂ  Â  if (type === 'year') {\nÂ  Â  Â  Â  // 12 meses del aÃ±o YYYY-MM\nÂ  Â  Â  Â  const year = s.getUTCFullYear();\nÂ  Â  Â  Â  for (let m = 0; m < 12; m++) {\nÂ  Â  Â  Â  Â  Â  const ym = `${year}-${String(m + 1).padStart(2, '0')}`;\nÂ  Â  Â  Â  Â  Â  list.push(ym);\nÂ  Â  Â  Â  }\nÂ  Â  }\nÂ  Â  else if (type === 'month' || type === 'week') {\nÂ  Â  Â  Â  // dÃ­as entre start y end (inclusive) YYYY-MM-DD\nÂ  Â  Â  Â  while (cur <= e) {\nÂ  Â  Â  Â  Â  Â  const d = [\nÂ  Â  Â  Â  Â  Â  Â  Â  cur.getUTCFullYear(),\nÂ  Â  Â  Â  Â  Â  Â  Â  String(cur.getUTCMonth() + 1).padStart(2, '0'),\nÂ  Â  Â  Â  Â  Â  Â  Â  String(cur.getUTCDate()).padStart(2, '0')\nÂ  Â  Â  Â  Â  Â  ].join('-');\nÂ  Â  Â  Â  Â  Â  list.push(d);\nÂ  Â  Â  Â  Â  Â  // Avanzar al siguiente dÃ­a UTC\nÂ  Â  Â  Â  Â  Â  cur.setUTCDate(cur.getUTCDate() + 1);\nÂ  Â  Â  Â  Â  Â  // Seguridad anti-bucle infinito (muy improbable con fechas vÃ¡lidas)\nÂ  Â  Â  Â  Â  Â  if (list.length > 366) { // A year has max 366 days, any range > year is unintended\nÂ  Â  Â  Â  Â  Â  Â  Â  node.warn(\"genPeriods excediÃ³ lÃ­mite de iteraciones (posible bucle)\");\nÂ  Â  Â  Â  Â  Â  Â  Â  break;\nÂ  Â  Â  Â  Â  Â  }\nÂ  Â  Â  Â  }\nÂ  Â  }\nÂ  Â  else if (type === 'day') {\nÂ  Â  Â  Â  // 24 horas del dÃ­a YYYY-MM-DD HH:00:00\nÂ  Â  Â  Â  const dayStr = start; // start es YYYY-MM-DD\nÂ  Â  Â  Â  for (let h = 0; h < 24; h++) {\nÂ  Â  Â  Â  Â  Â  const hh = String(h).padStart(2, '0');\nÂ  Â  Â  Â  Â  Â  list.push(`${dayStr} ${hh}:00:00`);\nÂ  Â  Â  Â  }\nÂ  Â  }\nÂ  Â  return list;\n}\n\n// Map de datos SQL para lookup rÃ¡pido usando 'periodo' como clave\nconst dataMap = {};\nrows.forEach(r => {\nÂ  Â  // Asegurarse que el periodo no sea null/undefined\nÂ  Â  if (r && r.periodo !== null && r.periodo !== undefined) {\nÂ  Â  Â  Â  dataMap[r.periodo] = {\nÂ  Â  Â  Â  Â  Â  // Usamos los nuevos nombres de columna\nÂ  Â  Â  Â  Â  Â  e_cons: r.E_Consumido_Direct === null ? 0 : Number(r.E_Consumido_Direct) || 0,\nÂ  Â  Â  Â  Â  Â  e_sum: r.E_Suministrada_RED === null ? 0 : Number(r.E_Suministrada_RED) || 0\nÂ  Â  Â  Â  };\nÂ  Â  } else {\nÂ  Â  Â  Â  node.warn(`Fila SQL ignorada por periodo invÃ¡lido: ${JSON.stringify(r)}`);\nÂ  Â  }\n});\n\n// Generamos todas las etiquetas posibles segÃºn el periodo y las fechas reales\nconst fullPeriods = genPeriods(startDate, endDate, periodType);\n\n// Construimos el objeto que necesita el nodo ui_chart\nlet chart = {\nÂ  Â  // Actualizamos los nombres de las series\nÂ  Â  series: [\"E_Consumido_Direct\", \"E_Suministrada_RED\"],\nÂ  Â  data: [[], []], Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Arrays de datos, uno por serie\nÂ  Â  labels: [] Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Etiquetas del eje X\n};\n\n// Llenamos el chart con los datos, usando 0 si no hay datos para un periodo\nfullPeriods.forEach(pv => {\nÂ  Â  // Formateamos la etiqueta: Hora para 'day', fecha/mes para otros\nÂ  Â  let label;\nÂ  Â  if (periodType === 'day') {\nÂ  Â  Â  Â  try {\nÂ  Â  Â  Â  Â  Â  Â // Intenta crear una fecha (puede fallar si pv no es formato esperado)\nÂ  Â  Â  Â  Â  Â  Â // Asumimos pv es 'YYYY-MM-DD HH:00:00'\nÂ  Â  Â  Â  Â  Â  const dateObj = new Date(pv.replace(' ', 'T') + 'Z'); // Interpretar como UTC\nÂ  Â  Â  Â  Â  Â  Â if (!isNaN(dateObj)) {\nÂ  Â  Â  Â  Â  Â  Â  Â  // Usar toLocaleTimeString para formato local HH:MM (UTC)\nÂ  Â  Â  Â  Â  Â  Â  Â  Â label = dateObj.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' });\nÂ  Â  Â  Â  Â  Â  Â  Â  Â // Fallback por si toLocaleTimeString da problemas en algÃºn entorno\nÂ  Â  Â  Â  Â  Â  Â  Â  Â if (!label || label.includes(\"Invalid\")) {\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  const h = dateObj.getUTCHours();\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  const min = dateObj.getUTCMinutes();\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  label = `${String(h).padStart(2,'0')}:${String(min).padStart(2,'0')}`;\nÂ  Â  Â  Â  Â  Â  Â  Â  Â }\nÂ  Â  Â  Â  Â  Â  Â } else {\nÂ  Â  Â  Â  Â  Â  Â  Â  Â label = pv; // Usar el string original si falla la conversiÃ³n\nÂ  Â  Â  Â  Â  Â  Â }\nÂ  Â  Â  Â  } catch(e) {\nÂ  Â  Â  Â  Â  Â  label = pv; // Fallback si hay error\nÂ  Â  Â  Â  }\nÂ  Â  } else {\nÂ  Â  Â  Â  label = pv; // Para year, month, week, usar YYYY-MM o YYYY-MM-DD\nÂ  Â  }\nÂ  Â  chart.labels.push(label);\n\nÂ  Â  // Busca el dato en el map usando los nuevos nombres de clave, o usa {0, 0}\nÂ  Â  const entry = dataMap[pv] || { e_cons: 0, e_sum: 0 };\nÂ  Â  chart.data[0].push(entry.e_cons); // E_Consumido_Direct data\nÂ  Â  chart.data[1].push(entry.e_sum); Â // E_Suministrada_RED data\n});\n\n// El nodo ui_chart espera un array que contenga el objeto chart\nmsg.payload = [chart];\n\n// Limpiamos propiedades auxiliares que ya no necesitamos\ndelete msg.selected_period;\ndelete msg.startDate;\ndelete msg.endDate;\ndelete msg.topic; // El topic SQL ya no es necesario\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1790,
        "y": 480,
        "wires": [
            [
                "41ef5e6f770811db",
                "6d5655c24320f762",
                "26825d69f722cab8"
            ]
        ]
    },
    {
        "id": "968bce566a51f483",
        "type": "mysql",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "mydb": "8abc56218783dc0e",
        "name": "DB_Fotov_UNIV_Madrid",
        "x": 1430,
        "y": 960,
        "wires": [
            [
                "f6f619f0448031fb",
                "9ca92545bcb3112e"
            ]
        ]
    },
    {
        "id": "5100f29857b7e882",
        "type": "mysql",
        "z": "2712839e4de2d960",
        "g": "7270bff791d922f6",
        "mydb": "8abc56218783dc0e",
        "name": "DB_Fotov_UNIV_Madrid",
        "x": 1500,
        "y": 1160,
        "wires": [
            [
                "6d8910b10fc02638",
                "d5a21d2008515361"
            ]
        ]
    },
    {
        "id": "295aeb3170c36013",
        "type": "ui_spacer",
        "z": "2712839e4de2d960",
        "name": "spacer",
        "group": "0a6525c364ecabac",
        "order": 5,
        "width": "17",
        "height": "2"
    },
    {
        "id": "5a8b10e16bc2ff01",
        "type": "ui_spacer",
        "z": "2712839e4de2d960",
        "name": "spacer",
        "group": "0a6525c364ecabac",
        "order": 3,
        "width": "4",
        "height": "2"
    },
    {
        "id": "8abc56218783dc0e",
        "type": "MySQLdatabase",
        "name": "Datos_UNI_Madrid",
        "host": "127.0.0.1",
        "port": "3306",
        "db": "Datos_Fotov_UNI_Madrid_db",
        "tz": "",
        "charset": "UTF8"
    },
    {
        "id": "0a6525c364ecabac",
        "type": "ui_group",
        "name": "Default",
        "tab": "c3916878ce0ac060",
        "order": 1,
        "disp": false,
        "width": "42",
        "collapse": false,
        "className": ""
    },
    {
        "id": "c3916878ce0ac060",
        "type": "ui_tab",
        "name": "FOTOVOLTAICA UNIVERSIDAD DE MADRID",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    }
]